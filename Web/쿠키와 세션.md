## 쿠키와 세션

Session: 서버에서 생성되는 기본 객체

- 브라우저에서 서버로 자원 요청
    - 웹 브라우저에서 서버로 request(요청)을 하면 서버에서 요청을 받았을 때 그 요청 안에 이 브라우저의 요청이, 이 브라우저가 누구인지 서버 입장에서 식별한다.
    - 지금 이 요청을 어떤 브라우저가 보낸 것인지 식별해야 하는데 최초로 서버에 요청을 했으면 이 브라우저에 대한 내용이 누군지 모를 것이다. (서버 입장에서는 어떤 브라우저가 나에게 무언가를 요청했는지 알 수 없다.)

- 서버에서 세션을 생성하고 쿠키에 담아 응답
    - 따라서, 서버 쪽에서는 이 브라우저를 식별할 수 있도록 세션이라는 기본 객체를 하나 만든다. 그리고 만들어진 세션 객체에는 세션 ID라고 하는 값이 있다.
    - 그러면 이 세션을 쿠키에 이 세션 값을 담아서 쿠키로 생성해서 response(응답)을 하게 된다.

- 브라우저는 세션 ID 값을 가지는 쿠키를 로컬에 저장
    - 브라우저는 그 쿠키를 자신의 브라우저 로컬에 저장한다.
    - 이렇게 저장된 쿠키는 이 서버로 요청할 떄마다 같이 포함해서 보낸다.

- 이후 브라우저에서 서버로 자원 요청시마다 세션 쿠키도 함께 전송
    - 서버에서는 요청(request)에서 쿠키정보를 확인한다.
    - JSESSIONID 쿠키 값을 이용해 브라우저를 식별한다.

    ---

    - 이제 브라우저에서 서버로 요청을 할 때마다 이 쿠키 정보를 다 전달하게 되어 있으니까 그 안에 JSESSIONID (예: 톰캣에선 JSESSIONID. 이 서버가 다른 서버라면 세션 ID 이름값들도 다르게 표현) 가 들어있다.
    - 그래서 이러한 형태의 어떤 아이디 값을 이용한 쿠키를 요청할 떄마다 같이 보내주게 되고
    - 그러면 서버 입장에서는 요청 안에 포함된 쿠키 정보중에서 JSESSIONID 라는 이름을 가진 쿠키가 있다면
    - 이 쿠키에 들어있는 세션 정보를 통해 어떤 브라우저인지 식별할 수 있게 된다.


---

세션은 기본적으로는 웹 서버에 요청을 보낸 클라이언트를 구분하는 역할을 한다.


+) 세션은 브라우저마다 하나씩 만들어지는 것이니까 이를 활용해서 

우리가 로그인을 했을 때 로그인 관련된 중요한 정보라든지

클라이언트에 저장시키면 위험한 것, 민감한 정보들.

이런 것들을 세션에 저장해둘 수 있다. 

⇒ 기본적으로는 JSESSIONID라는 쿠키를 이용해서 어떤 브라우저인지를 식별하게 된다. 라는 이야기.

- 세션은 브라우저를 종료하거나 서버에서 session.invalidate() 호출 시 제거됨
    1. 세션은 브라우저를 종료시켜서 종료된다는 메시지가 서버에 전달될 때.
    2. 서버쪽에서 해당 세션 기본 객체의 invalidate() 호출을 하면 이 세션 객체가 사라진다. 
        1. 그럼 요청이 왔을 때 서버에서 식별하지 못하는 세션 ID니까 (듣보잡 id) ‘이건 처음 요청하는 거구나’ 그래서 새로운 세션을 생성한다. 

    ⇒ 브라우저를 종료하거나 session.invalidate()를 통해 세션 객체를 사라지게 만들면 

    (녹색 쿠키 정보가 서버에 왔을텐데, 녹색 세션 정보가 없으니깐 이 녹색쿠키 정보는 모르는것임! 그럼 서버에서는 듣보 세션쿠키 정보니까 새로운 세션을 만들고 새로 만들어진 세션을 응답을 해줘서 쿠키를 다시 저장하게 만든다.)

